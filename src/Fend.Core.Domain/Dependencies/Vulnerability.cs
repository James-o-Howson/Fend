using Fend.Core.Domain.Dependencies.ValueObjects;
using Fend.Core.Domain.Dependencies.ValueObjects.Ids;
using Fend.Core.SharedKernel.Abstractions;

namespace Fend.Core.Domain.Dependencies;

public sealed class Vulnerability : IEntity<VulnerabilityId>, IAuditableEntity
{
    private Vulnerability() { }
    
    public VulnerabilityId Id { get; init; }
    public string OsvId { get; private set; } = string.Empty;
    public VulnerabilityState State { get; private set; } = VulnerabilityState.New;
    public VulnerabilitySeverity? Severity { get; private set; }
    public DateTime? Published { get; private set; }
    public string? Summary { get; private set; }
    public string? Details { get; private set; }
    
    public DateTime Created { get; set; }
    public string? CreatedBy { get; set; }
    public DateTime LastModified { get; set; }
    public string? LastModifiedBy { get; set; }
    
    internal static Vulnerability Create(string osvId) => new()
    {
        OsvId = osvId
    };

    public void Update(string summary, string details, DateTime? published, VulnerabilitySeverity severity)
    {
        Summary = summary;
        Details = details;
        Published = published;
        Severity = severity;
        
        State = VulnerabilityState.Complete;
    }
}